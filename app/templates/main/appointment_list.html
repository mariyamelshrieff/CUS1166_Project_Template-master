{% extends 'menu.html' %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='tempusdominus-datetime-picker/css/tempusdominus-bootstrap-4.min.css')}}" />
{% endblock %}

{% block main_content %}
    <div class="container">
    <h1>Appointment List</h1>
        <hr>
    <div class="input-group md-form form-sm form-2 pl-0">
      <input class="form-control my-0 py-1 red-border" type="text" placeholder="Search Appointment Title" aria-label="Search" id="s">
      <div class="input-group-append">
          <button class="btn btn-outline-secondary" type="button" id="search-btn" onclick="simpleSearch()"><i class="fa fa-fw fa-search" title="Search"></i></button>
          <button class="btn btn-outline-secondary" type="button" id="advance-btn" data-toggle="modal" data-target="#confirmDeleteOrder"><i class="fa fa-fw fa-binoculars" title="Advanced Search"></i></button>
      </div>
    </div>

    <div id="searchHint" class="text-danger"></div>

        <hr>
        <a href="{{ url_for('main.app_create') }}" class="btn btn-primary"><i class="fa fa-plus"></i></a>
        <a href="{{ url_for('main.app_list') }}" class="btn btn-success"><i class="fa fa-list"></i></a>
    <table class="table table-hover table-striped table-bordered">
        <thead>
        <tr class="text-center">
            <th>#</th>
            <th>Title</th>
            <th>Customer</th>
            <th>Location</th>
            <th>Date</th>
            <th>Time</th>
            <th>Duration(in minutes)</th>
            <th>Is Completed</th>
            <th>Is Overdue</th>
            <th>Option</th>
        </tr>
        </thead>
        <tbody>
        {% for a in ls.items %}
        {% if is_overdue == 'Overdue'  %}
            {% if not a.is_overdue %}

            {% else %}
          <tr class="text-center">
            <td>{{ a.id }}</td>
            <td>{{ a.title }}</td>
            <td>{{ a.customer }}</td>
            <td>{{ a.location }}</td>
            <td>{{ a.start_time.date() }}</td>
            <td>{{ a.start_time.time() }}</td>
            <td>{{ a.duration }}</td>
            <td>{{ a.is_completed }}</td>
            <td>{{ a.is_overdue }}</td>
            <td>
                <a href="{{ url_for('main.app_view', _id=a.id) }}" class="btn btn-primary"><i class="fa fa-eye"></i></a>
                <a href="{{ url_for('main.app_edit', _id=a.id) }}" class="btn btn-warning"><i class="fa fa-edit"></i></a>
                <a href="{{ url_for('main.app_delete', _id=a.id) }}" class="btn btn-danger"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
            {% endif %}

        {% elif is_overdue == 'Not Overdue' %}
            {% if not a.is_overdue %}
             <tr class="text-center">
            <td>{{ a.id }}</td>
            <td>{{ a.title }}</td>
            <td>{{ a.customer }}</td>
            <td>{{ a.location }}</td>
            <td>{{ a.start_time.date() }}</td>
            <td>{{ a.start_time.time() }}</td>
            <td>{{ a.duration }}</td>
            <td>{{ a.is_completed }}</td>
            <td>{{ a.is_overdue }}</td>
            <td>
                <a href="{{ url_for('main.app_view', _id=a.id) }}" class="btn btn-primary"><i class="fa fa-eye"></i></a>
                <a href="{{ url_for('main.app_edit', _id=a.id) }}" class="btn btn-warning"><i class="fa fa-edit"></i></a>
                <a href="{{ url_for('main.app_delete', _id=a.id) }}" class="btn btn-danger"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
            {% else %}

            {% endif %}
        {% else %}
            <tr class="text-center">
            <td>{{ a.id }}</td>
            <td>{{ a.title }}</td>
            <td>{{ a.customer }}</td>
            <td>{{ a.location }}</td>
            <td>{{ a.start_time.date() }}</td>
            <td>{{ a.start_time.time() }}</td>
            <td>{{ a.duration }}</td>
            <td>{{ a.is_completed }}</td>
            <td>{{ a.is_overdue }}</td>
            <td>
                <a href="{{ url_for('main.app_view', _id=a.id) }}" class="btn btn-primary"><i class="fa fa-eye"></i></a>
                <a href="{{ url_for('main.app_edit', _id=a.id) }}" class="btn btn-warning"><i class="fa fa-edit"></i></a>
                <a href="{{ url_for('main.app_delete', _id=a.id) }}" class="btn btn-danger"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
        </tbody>
    </table>
    {% if not is_overdue %}
    {% from "bootstrap/pagination.html" import render_pagination %}
    {{render_pagination(pagination=ls, prev='«', next='»', ellipses='…', size='sm')}}
    {% endif %}

    <div id="confirmDeleteOrder" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteOrderTitle" style="display: none;" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteOrderTitle">Advanced Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
      <form action="" method="get" id="advanceSearchForm">
          <div class="form-group">
            <label for="is_completed">Is Completed</label>
        <select name="is_completed" id="is_completed">
            <option value=""></option>
            <option value="Not Completed">Not Completed</option>
            <option value="Completed">Completed</option>
        </select>
        </div>

          <div class="form-group">
            <label for="is_overdue">Is Overdue</label>
        <select name="is_overdue" id="is_overdue">
            <option value=""></option>
            <option value="Not Overdue">Not Overdue</option>
            <option value="Overdue">Overdue</option>
        </select>

        </div>

        <div class="form-group">
            <label for="name">Title</label>

            <input class="form-control" id="title" name="title" required="" type="text" value="">
        </div>
        <div class="form-group">
            <label for="model">Customer</label>

            <input class="form-control" id="customer" name="customer" type="text" value="">
        </div>
        <div class="form-group">
            <label for="model">Location</label>
            <input class="form-control" id="location" name="location" type="text" value="">
        </div>
        <div class="form-group">
            <label for="model">Note</label>
            <input class="form-control" id="note" name="note" type="text" value="">
        </div>
        <div class="form-group">
            <label for="duration">Duration(in Minutes)</label>
            <div class="row">
                <div class="input-group col-md-6">

                    <input class="form-control" id="duration_from" min="10" name="duration_from" step="any" type="number" value="">
                </div>
                <div class="input-group col-md-6">
                    <input class="form-control" id="duration_to" min="10" name="duration_to" step="any" type="number" value="">

                </div>
            </div>

        </div>
        <div class="form-group">
            <label for="birth">Appointment Date</label>

                <p class="help-block text-primary">example 2019-01-01 00:00:00</p>
            <div class="row">
                <div class="input-group date col-md-12" id="datetimepicker1" data-target-input="nearest">

                    <input class="form-control datetimepicker-input" data-target="#datetimepicker1" id="begin" name="begin" type="text" value="">
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker" size="30">
                        <div class="input-group-text"><i class="fa fa-fw fa-calendar"></i></div>
                    </div>
                </div>

                <div class="input-group date col-md-12" id="datetimepicker2" data-target-input="nearest">

                    <input class="form-control datetimepicker-input" data-target="#datetimepicker2" id="end" name="end" type="text" value="">
                    <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker" size="30">
                        <div class="input-group-text"><i class="fa fa-fw fa-calendar"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal"><i class="fa fa-fw fa-reply"></i>Cancel</button>
        <button type="button" class="btn btn-danger" onclick="advanceSearch()"><i class="fa fa-fw fa-search"></i>Search</button>
      </div>
    </div>
  </div>
    </div>


    </div>
{% endblock %}

{% block scripts %}
{{ super() }}
    <script src="{{ url_for('static', filename='moment.js/moment-with-locales.min.js') }}"></script>
    <script src="{{ url_for('static', filename='tempusdominus-datetime-picker/js/tempusdominus-bootstrap-4.min.js') }}"></script>
    <script>
    let qs = new URLSearchParams(window.location.search);
    moment.locale('en-us');
    $.fn.datetimepicker.Constructor.Default = $.extend({}, $.fn.datetimepicker.Constructor.Default, {
            icons: {
                time: 'fa fa-fw fa-clock',
                date: 'fa fa-fw fa-calendar',
                up: 'fa fa-fw fa-arrow-circle-up',
                down: 'fa fa-fw fa-arrow-circle-down',
                previous: 'fa fa-fw fa-arrow-circle-left',
                next: 'fa fa-fw fa-arrow-circle-right',
                today: 'fa fa-fw fa-calendar-check-o',
                clear: 'fa fa-fw fa-trash',
                close: 'fa fa-fw fa-times'
            },
            });
    $('#datetimepicker1').datetimepicker({
        locale: 'en-us-cn',
        format: 'YYYY-M-D HH:mm',
                });
    $('#datetimepicker2').datetimepicker({
        locale: 'en-us-cn',
        format: 'YYYY-M-D HH:mm',
                });
    $(document).ready(function() {
    let tagArray = ['s',  'title', 'customer',
        'begin', 'end',
        'duration_from', 'duration_to',
        'location', 'note', ];
    for (let i = 0; i < tagArray.length; i++){
        let name = tagArray[i];
        if (qs.has(name)){ $('#'+name).val(qs.get(name)) }
    }
    let results = getParameters();
});
    function simpleSearch() {
        let name = $('#s').val();
        if (! name){
            $('#searchHint').text('Please type in some keywords');
            return
        }
        window.location = '{{ url_for('main.app_list') }}?search_tag=off&title='+name;
    }
    $('#s').keydown(function (e) {
        if (e.keyCode ===13){
            simpleSearch();
        }
    });
    function advanceSearch() {
        console.log('advanced search');
        $('#advanceSearchForm').submit();
    }
    function getParameters() {
    let theArray = ['page', 'per_page'];
    let default_values = ['1', '20'];
    let results = {};
    for (let i=0; i <= theArray.length; i++) {
        results[theArray[i]] = getP(theArray[i], default_values[i]);
    }
    return results
}
function getP(name, default_var) {
    let qs = new URLSearchParams(window.location.search);
    if (qs.has(name)) {
        return qs.get(name)
    } else {
        return default_var
    }
}
    </script>
{% endblock %}